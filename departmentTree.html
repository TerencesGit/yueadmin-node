<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>悦视觉-</title>
  <link rel="shortcut icon" href="assets/img/favicon.ico">
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/font-awesome.min.css">
  <link rel="stylesheet" href="assets/css/animate.min.css">
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="assets/plugins/zTree/css/zTreeStyle.css">
  <style>
    .ztree li span.button.add {
      margin-left: 2px;
      margin-right: -1px;
      background-position: -144px 0;
      vertical-align: top;
    }
    form{
      padding: 20px;
      background: #fff
    }
    .container-fluid {
      padding: 20px;
    }
  </style>
  <!--[if lt IE 9]>
      <meta http-equiv="refresh" content="0;ie.html" />
  <![endif]-->
</head>
<body>
  <div class="animated fadeInRight">
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-3">
          <h2 class="page-header">部门结构</h2>
          <ul id="treeDemo" class="ztree"></ul>
        </div>
        <div class="col-md-5">
          <h2 class="page-header">信息展示</h2>
          <form action="#" class="form-horizontal" role="form">
            <div class="form-group">
              <label class="col-sm-2 control-label">员工编号</label>
              <div class="col-sm-10">
                <input type="text" id="departId" class="form-control">
              </div>
            </div>
            <div class="form-group">
              <label class="col-sm-2 control-label">员工名称</label>
                <div class="col-sm-10">
                  <input type="text" id="departName" class="form-control">
                </div>
            </div>
            <div class="form-group">
              <label class="col-sm-2 control-label">部门编号</label>
              <div class="col-sm-10">
                <input type="text" id="parentId" class="form-control">
              </div>
            </div>
            <div class="form-group">
              <div class="col-sm-offset-4 col-sm-6">
                <button class="btn btn-primary">确定</button>
               <!--  <button id="update" class="btn btn-warning">修改</button>
                <button id="remove" class="btn btn-danger">删除</button> -->
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="row">
        <h2 class="page-header">JSON数据</h2>
        <div class="col-md-8">
           <textarea name="" id="output" class="form-control" cols="60" rows="10"></textarea>
        </div>  
      </div>
    </div>
    <footer class="site-footer">
      <span>Copyright © 2016 yueshijue.com</span>
    </footer>
  </div>
  </section>
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/bootstrap.min.js"></script>
  <script src="assets/plugins/zTree/js/jquery.ztree.all.min.js"></script>
  <script src="assets/js/main.js"></script>
  <script>
    var setting = {
      view: {
        addHoverDom: addHoverDom,
        removeHoverDom: removeHoverDom,
        selectedMulti: true
      },
      edit: {
        enable: true,
        showRenameBtn: showRenameBtn,
        showRemoveBtn: showRemoveBtn,
        drag: {
          isMove: true
        }
      },
      data: {
        simpleData: {
          enable: true
        }
      },
      check: {
        enable: true
      },
      callback: {
        beforeRemove: beforeRemove,
        beforeRename: beforeRename,
        onCheck: triggerEvent,
        onRemove: triggerEvent,
        onRename: triggerEvent,
        onDrop: triggerEvent,
        onNodeCreated: triggerEvent,
        onClick: HandlerClick,
      }
    }
    function beforeRemove(treeId, treeNode) {
      var zTree = $.fn.zTree.getZTreeObj("treeDemo");
      zTree.selectNode(treeNode);
      return confirm("确认删除 节点 -- " + treeNode.name + " 吗？");
    }
    function beforeRename(treeId, treeNode, newName, isCancel) {
      if (newName.length === 0) {
        setTimeout(function() {
          var zTree = $.fn.zTree.getZTreeObj("treeDemo");
          zTree.cancelEditName();
          alert("节点名称不能为空");
        }, 0);
        return false;
      }
      return true;
    }
    var newCount = 1;
    function addHoverDom(treeId, treeNode) {
      var sObj = $("#" + treeNode.tId + "_span");
      if (treeNode.editNameFlag || $("#addBtn_"+treeNode.tId).length>0) return;
      var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
        + "' title='add node' onfocus='this.blur();'></span>";
      sObj.after(addStr);
      var btn = $("#addBtn_"+treeNode.tId);
      if (btn) btn.bind("click", function(){
        var zTree = $.fn.zTree.getZTreeObj("treeDemo");
        zTree.addNodes(treeNode, {id:(100 + newCount), pId:treeNode.id, name:"new node" + (newCount++)});
        return false;
      });
    };
    function removeHoverDom(treeId, treeNode) {
      $("#addBtn_"+treeNode.tId).unbind().remove();
    };
    function showRenameBtn(treeId, treeNode){
      return !treeNode.isLastNode;
    }
    function showRemoveBtn(treeId, treeNode){
      return !treeNode.isParent;
    }
    function triggerEvent(event, treeId, treeNode){
      $('#output').val(window.JSON.stringify(treeNode))
    }
    function HandlerClick(event, treeId, treeNode){
      var id = treeNode.id;
      var name = treeNode.name;
      var parentId = treeNode.parentTId;
      $('#departId').val(id)
      $('#departName').val(name)
      $('#parentId').val(parentId)
    }
    // var zNodes = [{
    //   name: "部门1",
    //   open: true,
    //   children: [{
    //     name: "员工1_1"
    //   }, {
    //     name: "员工1_2"
    //   }]
    // }, {
    //   name: "部门2",
    //   open: true,
    //   children: [{
    //     name: "员工2_1"
    //   }, {
    //     name: "员工2_2"
    //   }]
    // }];
    var zNodes =[
      { id:1, pId:0, name:"部门 1", open:false},
      { id:11, pId:1, name:"员工 1-1"},
      { id:12, pId:1, name:"员工 1-2"},
      { id:13, pId:1, name:"员工 1-3"},
      { id:2, pId:0, name:"部门 2", open:true},
      { id:21, pId:2, name:"员工 2-1"},
      { id:22, pId:2, name:"员工 2-2"},
      { id:23, pId:2, name:"员工 2-3"},
      { id:3, pId:0, name:"部门 3", open:true},
      { id:31, pId:3, name:"员工 3-1"},
      { id:32, pId:3, name:"员工 3-2"},
      { id:33, pId:3, name:"员工 3-3"}
    ];
    $(function(){
      $.fn.zTree.init($('#treeDemo'), setting, zNodes)
    })
  </script>
</body>
</html>