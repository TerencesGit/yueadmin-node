<!DOCTYPE html>
<html>
  <head>
    <%- include('../link') %>
    <link rel="stylesheet" href="/plugins/cityPicker/css/hzw-city-picker.css">
  </head>
  <body>
    <%- include('../aside') %>
    <%- include('../header') %>
    <div id="main" class="main" data-id="account_info">
      <div class="wrapper animated fadeInRight">
        <div class="container-fluid">
          <ol class="breadcrumb">
              <li><a href="#">账户管理</a></li>
              <li class="active">信息维护</li>
          </ol>
          <div class="row">
            <div class="col-md-2">
              <ul class="list-group">
                  <li class="list-group-item active">个人信息</li>
                  <li class="list-group-item">
                    <a href="#">基本信息</a>
                  </li>
                  <li class="list-group-item">
                    <a href="#">基本信息</a>
                  </li>
                  <li class="list-group-item">
                    <a href="#">基本信息</a>
                  </li>
                  <li class="list-group-item">
                    <a href="#">基本信息</a>
                  </li>
                  <li class="list-group-item">
                    <a href="#">基本信息</a>
                  </li>
                  <li class="list-group-item">
                    <a href="#">自我介绍</a>
                  </li>
                  <li class="list-group-item">
                    <a href="#">个人证件</a>
                    <span class="badge">新</span>
                  </li>
                  <li class="list-group-item">
                    <span class="badge">新</span>
                    <a href="#">备注</a>
                  </li>
              </ul>
            </div>
            <div class="col-md-offset-1 col-md-5 account-info">
              <form method="post" action="/user/saveInfo" id="infoForm" class="form-horizontal" role="form">        
                <div class="form-group">
                  <label class="col-md-3 control-label">昵称</label>
                  <div class="col-md-6">
                    <input type="text" id="name" class="form-control" name="user[name]" value="<%= user.name %>">
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-md-3 control-label">邮箱</label>
                  <div class="col-md-6">
                    <% if(user && user.email){ %> 
                    <span><%= user.email %></span>
                    <a href="javascript:;" class="unbind email">修改</a>
                    <% }else{ %>
                    <a href="javascript:;" class="unbind email">未绑定</a>
                    <%}%>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-md-3 control-label">手机号</label>
                  <div class="col-md-6">
                    <% if(user && user.mobile){ %> 
                    <input type="text" class="form-control" name="user[mobile]" value="<%= user.mobile %>">
                    <% }else{ %>
                    <a href="javascript:;" class="unbind mobile">未绑定</a>
                    <%}%>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-md-3 control-label">QQ</label>
                  <div class="col-md-6">
                    <input type="text" id="qq" class="form-control" name="user[qq]" value="<%= user.qq %>">
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-md-3 control-label">性别</label>
                  <div class="col-md-6">
                    <% if(user && user.gender && user.gender == '0'){ %> 
                    <label class="checkbox-inline">
                      <input type="radio" name="user[gender]" value="0" checked>男
                    </label>
                    <label class="checkbox-inline">
                      <input type="radio" name="user[gender]" value="1">女
                    </label>
                    <% }else{ %>
                    <label class="checkbox-inline">
                      <input type="radio" name="user[gender]" value="0" >男
                    </label>
                    <label class="checkbox-inline">
                      <input type="radio" name="user[gender]" value="1" checked>女
                    </label>
                    <%}%>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-md-3 control-label">生日</label>
                  <div class="col-md-6">
                    <input type="text" name="user[birthday]" id="birthday" class="form-control laydate-icon" value="<% if(user && user.birthday){ %> <%= moment(user.birthday).format('YYYY-MM-DD') %> <% } %>">
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-md-3 control-label"><i>*</i>身份证号</label>
                  <div class="col-md-6">
                     <input type="text" name="user[idcard]" id="idcard" class="form-control" value="<% if(user && user.idcard){ %> <%= user.idcard %> <% } %>">
                  </div>
                </div>
                 <div class="form-group">
                   <label class="col-md-3 control-label"><i>*</i>籍贯</label>
                   <div class="col-md-6">
                    <input type="text" name="user[address]" id="address" class="form-control" value="<% if(user && user.address){ %> <%= user.address %> <% } %>">
                   </div>
                </div>               
                <div class="form-group">
                  <label class="col-md-3 control-label">个性签名</label>
                  <div class="col-md-6">
                    <textarea class="form-control" name="user[signature]"><%if(user && user.signature){%><%= user.signature %><%}%></textarea>
                  </div>
                </div>
                <div class="form-group text-center"> 
                  <button type="submit" id="btnSubmit" class="btn btn-success">保存</button>
                  <button class="btn btn-default m-l">返回</button>
                </div>
              </form>
            </div>
            <div class="col-md-offset-1 col-md-3 info-upload">
              <dl class="form-group edit-avatar mr-4 float-right">
                <dt>个人头像</dt>
                <dd class="avatar-upload-container clearfix">
                  <form id="uploadForm" method="post" action="/user/avatarUpload" enctype="multipart/form-data">
                    <input type="file" name="avatar" id="fileUp">
                    <% if(user && user.avatar){ %>  <img id="avatar" class="avatar rounded-2" src="/upload/<%= user.avatar %>" width="200" height="200" alt="头像上传"/>
                    <% }else{ %> <img src="/img/avatar.jpg" id="avatar" class="avatar rounded-2" width="200" height="200" alt="头像上传"> <% } %>
                    <div class="avatar-upload">
                      <button type="submit" id="btnUpload" class="btn btn-info" style="width:200px">上传</button>
                    </div>
                  </form>
                </dd>
              </dl>
            </div>
          </div>
        </div>
        <div style="height: 500px"></div>
      </div>
    	<%- include('../footer') %>
    </div>
    <%- include('../script')%>
    <script src="/plugins/laydate/laydate.js"></script>
    <script src="/plugins/cityPicker/js/city-data.js"></script>
    <script src="/plugins/cityPicker/js/hzw-city-picker.min.js"></script>
    <script>
      //出生日期选择
      laydate({elem: '#birthday', max: laydate.now(-1)});

      //城市选择
      var cityPicker = new HzwCityPicker({
        data: data,
        target: 'address',
        valType: 'k-v',
        hideCityInput: {
            name: 'city',
            id: 'city'
        },
        hideProvinceInput: {
            name: 'province',
            id: 'province'
        },
      });
      cityPicker.init();

      //头像上传
      $('#fileUp').change(function(){
        uploadPreview(this, $('#avatar'))
      })
      $('#avatar').click(function(){
        $('#fileUp').click()
      })
      var fileUp = $('#fileUp')[0];
      $('#btnUpload').on('click', function(e){
        e.preventDefault()
        if(fileUp.files && fileUp.files[0]){
          $('#uploadForm').submit()
        }
      })
      //个人资料编辑
      var infoForm = $('#infoForm'),
          nameInput = $('#name'),
          qqInput = $('#qq'),
          idcardInput = $('#idcard'),
          addressInput = $('#address'),
          btnSubmit = $('#btnSubmit');
      //正则表达式
      var pattern = {
        name: /^.{3,20}$/,
        qq: /[1-9][0-9]{4,}/,
        idcard: /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,
      }
      // 错误信息提示
      var msg = {
        name: '不少于3位',
        qq: '格式有误！',
        idcard: '格式有误！',
        address: '不能为空！'
      }
      //表单提交
      btnSubmit.on('click', function(e){
        e.preventDefault()
        checkInput(nameInput, msg.name, pattern.name) &&
        checkInput(qqInput, msg.qq, pattern.qq) &&
        checkInput(idcardInput, msg.idcard, pattern.idcard) &&
        checkInput(addressInput, msg.address) && infoForm.submit()
      })
    </script>
  </body>
</html>
